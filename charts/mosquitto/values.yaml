controllers:
  main:
    containers:
      main:
        image:
          repository: eclipse-mosquitto
          tag: 2.0.18
          pullPolicy: IfNotPresent
        probes:
          liveness:
            enabled: true
          readiness:
            enabled: true
          startup:
            enabled: true
configMaps:
  config:
    enabled: true
    data:
      mosquitto.conf: |
        per_listener_settings false
        allow_anonymous false
        persistence true
        persistence_location /mosquitto/data
        autosave_interval 1800
        include_dir /mosquitto/configinc
        password_file /mosquitto/configinc/passwordfile
        listener 1883
        protocol mqtt
        listener 8083
        protocol websockets

service:
  main:
    type: LoadBalancer
    loadBalancerIP: 192.168.1.83
    ports:
      http:
        port: 1883
      websocket:
        enabled: true
        port: 8083

ingress:
  main:
    enabled: false
    hosts:
      - host: mosquitto.impl.nl
        paths:
          - path: /
            pathType: Prefix
            service:
              name: mqtt
              port: 1883
          - path: /
            pathType: Prefix
            service:
              name: ws
              port: 8083
persistence:
  configinc:
    type: persistentVolumeClaim
    existingClaim: mosquitto-inc-pvc
    globalMounts:
      - path: /mosquitto/configinc
  data:
    type: persistentVolumeClaim
    existingClaim: mosquitto-data-pvc
    globalMounts:
      - path: /mosquitto/data
  config:
    enabled: true
    type: configMap
    name: mosquitto-config
    globalMounts:
      - path: /mosquitto/config/mosquitto.conf
        subPath: mosquitto.conf
