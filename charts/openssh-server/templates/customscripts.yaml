---
apiVersion: v1
kind: ConfigMap
metadata:
  name: customscripts
data:
  install-packages.bash: |
    #!/bin/bash

    apk update
    apk upgrade

    {{- if .Values.packages }}
    apk add --no-cache{{- range .Values.packages }} {{ . }}{{- end }}  
    {{- end }}

    sed -i 's/#AllowAgentForwarding yes/AllowAgentForwarding yes/g' /etc/ssh/sshd_config
    sed -i 's/AllowTcpForwarding no/AllowTcpForwarding all/g' /etc/ssh/sshd_config
    sed -i 's/GatewayPorts no/GatewayPorts yes/g' /etc/ssh/sshd_config
    sed -i 's/X11Forwarding no/X11Forwarding yes/g' /etc/ssh/sshd_config
    sed -i 's/#VersionAddendum none/#VersionAddendum none\nPermitOpen any\n/g' /etc/ssh/sshd_config
    sed -i 's/#TCPKeepAlive yes/TCPKeepAlive yes/g' /etc/ssh/sshd_config
