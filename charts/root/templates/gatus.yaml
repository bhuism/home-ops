apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: gatus
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    server: https://kubernetes.default.svc
    namespace: gatus
  project: default
  source:
    chart: gatus
    repoURL: https://minicloudlabs.github.io/helm-charts
    targetRevision: 3.3.5
    helm:
      values: |
        metrics: true
        connectivity:
          checker:
            target: 1.1.1.1:53
            interval: 60s
        ingress:
          enabled: true
          ingressClassName: nginx
          annotations:
            external-dns.alpha.kubernetes.io/target: jasmine.odee.net
          labels: {}
          path: /
          pathType: Prefix
          extraPaths: []
          hosts:
            - gatus.impl.nl
        serviceMonitor:
          enabled: true
          namespace: prometheus
          labels:
            release: prometheus
        config:
          ui:
            header: Home-Ops
          storage:
            type: sqlite
            path: /data/data.db
          endpoints:
            - name: Gatus
              url: "https://gatus.impl.nl"
              interval: 5m
              conditions:
                - "[STATUS] == 200"
                - "[RESPONSE_TIME] < 500"
            - name: /v1/ip
              url: "https://api.jvdkolk.nl/v1/ip"
              interval: 5m
              conditions:
                - "[STATUS] == any(200,302)"
                - "[RESPONSE_TIME] < 1000"
            - name: /v1/time
              url: "https://api.jvdkolk.nl/v1/time?zone=Europe/Amsterdam"
              interval: 5m
              conditions:
                - "[STATUS] == 200"
                - "[RESPONSE_TIME] < 1000"
            - name: OkApplication
              url: "https://ok.impl.nl"
              interval: 5m
              conditions:
                - "[STATUS] == 200"
                - "[RESPONSE_TIME] < 1000"
                - "[BODY] == OK"
            - name: Grafana
              url: "https://grafana.impl.nl"
              interval: 5m
              conditions:
                - "[STATUS] == any(200, 429)"
                - "[RESPONSE_TIME] < 10000"
            - name: "Argo CD"
              url: "https://argocd.impl.nl"
              interval: 5m
              conditions:
                - "[STATUS] == 200"
                - "[RESPONSE_TIME] < 1000"
        nodeSelector:
          kubernetes.io/hostname: node3
        persistence:
          enabled: true
          size: 10Gi
          mountPath: /data
          # subPath: ""
          finalizers:
            - kubernetes.io/pvc-protection
          accessModes:
            - ReadWriteOnce
          storageClassName: local-path
          
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/audit: privileged
        pod-security.kubernetes.io/warn: privileged
    syncOptions:
      - CreateNamespace=true
