apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: homer
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    server: https://kubernetes.default.svc
    namespace: homer
  project: default
  source:
    chart: homer
    repoURL: https://djjudas21.github.io/charts/
    targetRevision: 8.1.9
    helm:
      valuesObject:
        env:
          TZ: "Europe/Amsterdam"
          IPV6_DISABLE: 1
        ingress:
          main:
            enabled: true
            ingressClassName: nginx
            annotations:
                external-dns.alpha.kubernetes.io/target: ingress.impl.nl
                external-dns.alpha.kubernetes.io/cloudflare-proxied: "false"
                cert-manager.io/cluster-issuer: letsencrypt-production
            pathType: Prefix
            extraPaths: []
            hosts:
              - host: www.impl.nl
                paths:
                  - path: /
            tls:
              - secretName: www.impl.nl
                hosts:
                  - www.impl.nl
        configmap:
          config:
            enabled: true
            data:
              config.yml: |
                links:
                  - name: "Link 1"
                    icon: "fab fa-github"
                    url: "https://github.com/bastienwirtz/homer"
                    target: "_blank" # optional html tag target attribute
                  - name: "link 2"
                    icon: "fas fa-book"
                    url: "https://github.com/bastienwirtz/homer"
                  # this will link to a second homer page that will load config from page2.yml and keep default config values as in config.yml file
                  # see url field and assets/page.yml used in this example:
                  - name: "Second Page"
                    icon: "fas fa-file-alt"
                    url: "#page2"
                services:
                  - name: "Pi-hole"
                    logo: "assets/tools/sample.png"
                    # subtitle: "Network-wide Ad Blocking" # optional, if no subtitle is defined, PiHole statistics will be shown
                    url: "https://pihole.impl.nl/admin"
                    apikey: "e16dcf7c10ef8be1f9e7c42660d3722c1244a45e976ce98a358296ada777bc0d"
                    type: "PiHole"
                  - name: "Ping"
                    type: Ping
                    logo: "assets/tools/sample.png"
                    url: "https://www.reddit.com/r/selfhosted/"
                    method: "head"

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
