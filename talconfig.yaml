clusterName: impl-k8s
talosVersion: v1.5.4
kubernetesVersion: v1.28.2
endpoint: https://control.impl.nl:6443
allowSchedulingOnMasters: true
additionalMachineCertSans:
      - 192.168.1.11
      - 192.168.1.153
      - 192.168.1.154
      - 192.168.1.155
      - 192.168.1.156
      - 192.168.1.157
      - 192.168.1.158
      - 192.168.1.159
      - control.impl.nl
      - node1.impl.nl
      - node2.impl.nl
      - node3.impl.nl
      - node4.impl.nl
      - jasmine.odee.net
additionalApiServerCertSans:
      - 192.168.1.11
      - 192.168.1.153
      - 192.168.1.154
      - 192.168.1.155
      - 192.168.1.156
      - 192.168.1.157
      - 192.168.1.158
      - 192.168.1.159
      - control.impl.nl
      - node1.impl.nl
      - node2.impl.nl
      - node3.impl.nl
      - node4.impl.nl
      - jasmine.odee.net
patches:
  - |-
    - op: add
      path: /machine/nodeLabels
      value:
        openebs.io/engine: mayastor
    - op: add 
      path: /machine/kubelet
      value:
        extraMounts:
          - destination: /var/local/localpv-hostpath/mayastor/etcd
            type: bind   
            source: /var/local/localpv-hostpath/mayastor/etcd
            options:
            - rbind
            - rshared
            - rw         
    - op: add
      path: /machine/features/kubePrism
      value:
        enabled: true
        port: 7445
    - op: add
      path: /machine/network/nameservers
      value:
        - 8.8.4.4
        - 1.1.1.1
        - 8.8.8.8
nodes:
  - hostname: node1
    ipAddress: 192.168.1.153
    controlPlane: true
    installDisk: /dev/mmcblk0
    # networkInterfaces:
    #   - interface: enxd83add379af1
    #     addresses:
    #       - 192.168.1.153/24
    #     routes:
    #       - network: 0.0.0.0/0
    #         gateway: 192.168.1.1
#        vip:
#          ip: 192.168.1.11
    patches:
      - |-
        - op: add
          path: /machine/sysctls
          value:
            vm.nr_hugepages: "1024"
        - op: add
          path: /machine/nodeLabels
          value:
            mayastorage.impl.nl:
            openebs.io/engine: mayastor
  - hostname: node2
    ipAddress: 192.168.1.154
    controlPlane: false
    installDisk: /dev/mmcblk0
    networkInterfaces:
      - interface: enxe45f01e07434
        addresses:
          - 192.168.1.154/24
        routes:
          - network: 0.0.0.0/0
            gateway: 192.168.1.1
  - hostname: node3
    ipAddress: 192.168.1.155
    controlPlane: true
    installDisk: /dev/mmcblk0
    networkInterfaces:
      - interface: enxe45f01e10b00
        addresses:
          - 192.168.1.155/24
        routes:
          - network: 0.0.0.0/0
            gateway: 192.168.1.1
#        vip: 
#          ip: 192.168.1.11
    patches:
      - |-
        - op: add
          path: /machine/nodeLabels
          value:
              mayastorage.impl.nl:
              openebs.io/engine: mayastor
        - op: add
          path: /machine/sysctls
          value:
              vm.nr_hugepages: "1024"
  - hostname: node4
    ipAddress: 192.168.1.156
    controlPlane: true
    installDisk: /dev/mmcblk0
    networkInterfaces:
      - interface: enxd83add3772b1
        addresses:
          - 192.168.1.156/24
        routes:
          - network: 0.0.0.0/0
            gateway: 192.168.1.1
#        vip: 
#          ip: 192.168.1.11
  - hostname: node5
    ipAddress: 192.168.1.113
    controlPlane: false
    installDisk: /dev/sda
#controlPlane:
#  patches:
#    - |-
#      - op: add
#        path: /machine/network/interfaces
#        value:
#          - interface: eth0
#            dhcp: true
#            vip:
#              ip: 192.168.1.11
#worker:
#  patches:
#    - |-
#      - op: add
#        path: /machine/network/interfaces
#        value:
#          - interface: eth0
#            dhcp: true
